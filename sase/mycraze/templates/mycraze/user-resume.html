{% extends "mycraze/tile/base.html" %}
{% load staticfiles %}
{% block title %} Resume {% endblock %}
{% block header %}
			{% include "mycraze/tile/header.html" with resumeClass="active"%}
{% endblock %}
{% block content %}
<!-- Sub Header -->
	<div class="bs-docs-header" id="content">
      	<div class="container">
			<div class="row">
				<div class="col-md-2">
					<img src="{{image_url}}{{ request.user.user_profile.profile_image }}" class="img-responsive" >
				</div>
				<div class="col-md-10">
        			<h1 id = "full-name">{{ request.user.first_name}} {{ request.user.last_name}}</h1>
        			<p id =  "description" class="lead">{{ request.user.user_profile.description }}</p>
        		</div>
        	</div>
      	</div>
		<div class="pull-right">
			<button type="button" class="btn btn-outline-inverse" data-toggle="modal" data-target="#edit-profile-modal"><i class="fa fa-pencil"></i></button>
		</div>
    </div>
    <!-- Page Main Content -->
    <div class="container bs-docs-container">
    	<div class="row">
    		<!-- Side pane content -->
    		<div class="col-md-3" role="complementary">
    			{% include "mycraze/widget/side-pane.html" %}
    		</div>
    		<!-- Main content of side pane sections -->
   			<div class="col-md-9" role="main">
   				{% include "mycraze/section/summary.html" %}
				{% include "mycraze/section/experience.html" %}
				{% include "mycraze/section/projects.html" %}
				{% include "mycraze/section/education.html" %}
				{% include "mycraze/section/links.html" %}
				{% include "mycraze/section/publications.html" %}
				{% include "mycraze/section/certifications.html" %}
				{% include "mycraze/section/skills.html" %}
				{% include "mycraze/section/courses.html" %}
				{% include "mycraze/section/awards.html" %}
				{% include "mycraze/section/languages.html" %}
				{% include "mycraze/section/contact.html" %}
	   		</div>
	   	</div>
    </div>
{% endblock %}

{% block hidden %}
	{% include "mycraze/modal/edit-profile-modal.html"%}
	{% include "mycraze/modal/edit-summary-modal.html"%}
	{% include "mycraze/modal/edit-experience-modal.html"%}
    {% include "mycraze/modal/edit-project-modal.html"%}
    {% include "mycraze/modal/edit-education-modal.html"%}
    {% include "mycraze/modal/edit-publication-modal.html"%}
	{% include "mycraze/modal/edit-contact-modal.html"%}
{% endblock %}

{% block javascript %}
{{ block.super }}
<script type="text/javascript">
$( document ).ready(function() {
	var editForm = $('#edit-profile-form');
    var editExperienceItem;
    var editProjectItem;
    var editEducationItem;
    var editPublicationItem;

    //profile
	$("#edit-profile-data").on('click',function(){
		submitEditProfileDataForm();
	});

    //summary
	$("#edit-summary-data").on('click',function(){
		editSummaryData();
	});

    //experience
    $("#add-experience").on('click',function(){
        $("#experience_item_id").val(0);
        editExperienceForm(0);
    });

	$("#edit-experience-data").on('click',function(){
		editExperienceData($("#experience_item_id").val());
	});

    $("body").on('click','li.btn-edit-experience',function(event){
        event.preventDefault();
        var element = $(this).parent().parent().parent();
        var elementParent = element.parent();
        var itemId = element.find("input").val();
        editExperienceForm(itemId);
        editExperienceItem = elementParent;
    });

    //project
    $("#add-project").on('click',function(){
        $("#project_item_id").val(0);
        editProjectForm(0);
    });

    $("#edit-project-data").on('click',function(){
        editProjectData($("#project_item_id").val());
    });

    $("body").on('click','li.btn-edit-project',function(event){
        event.preventDefault();
        var element = $(this).parent().parent().parent();
        var elementParent = element.parent();
        var itemId = element.find("input").val();
        editProjectForm(itemId);
        editProjectItem = elementParent;
    });

    //education
    $("#add-education").on('click',function(){
        $("#education_item_id").val(0);
        editEducationForm(0);
    });

    $("#edit-education-data").on('click',function(){
        editEducationData($("#education_item_id").val());
    });

    $("body").on('click','li.btn-edit-education',function(event){
        event.preventDefault();
        var element = $(this).parent().parent().parent();
        var elementParent = element.parent();
        var itemId = element.find("input").val();
        editEducationForm(itemId);
        editEducationItem = elementParent;
    });

    //publication
    $("#add-publication").on('click',function(){
        $("#publication_item_id").val(0);
        editPublicationForm(0);
    });

    $("#edit-publication-data").on('click',function(){
        editPublicationData($("#publication_item_id").val());
    });

    $("body").on('click','li.btn-edit-publication',function(event){
        event.preventDefault();
        var element = $(this).parent().parent().parent();
        var elementParent = element.parent();
        var itemId = element.find("input").val();
        editPublicationForm(itemId);
        editPublicationItem = elementParent;
    });

    //contact
	$("#edit-contact-data").on('click',function(){
		editContactData();
	});

    //profile
    submitEditProfileDataForm = function () {
        $.ajax({
            type: editForm.attr('method'),
            url: editForm.attr('action'),
            data: editForm.serialize(),
            beforeSend : function() {

            },
            success: function (data) {
                $("#full-name").text(data.first_name + " " + data.last_name);
				$("#description").text(data.description);
				$("#edit-profile-modal").modal('toggle');
            },
            error: function(data) {
                
            },
            complete : function() {
            	
            }
        });
        return false;
    };

    //summary
    editSummaryData = function () {
        $.ajax({
        	type: 'POST',
            url: "{% url 'edit_summary' %}",
            data: {
        		csrfmiddlewaretoken: '{{ csrf_token }}',
        		content: $("#summary-data").val(),
    		},
            beforeSend : function() {

            },
            success: function (data) {
            	$("#summary-content").text(data.content);
                $("#edit-summary-modal").modal('toggle');
            },
            error: function(data) {
                
            },
            complete : function() {
            	
            }
        });
    };

    //experience
    editExperienceForm = function(itemId) {
        //get the form for add/edit experience for the user to either add or edit
        $.ajax({
            type: 'POST',
            url: "{% url 'get_experience_form' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                id: itemId,
            },
            beforeSend : function() {

            },
            success: function (data) {
                $("#edit-experience-modal").modal('show');                
                $("#experience-form-body").html(data);
                $("#experience_item_id").val(itemId);
                $("#edit-experience-data").attr("data-type", itemId);
            },
            error: function(data) {
                
            },
            complete : function() {
                
            }
        });
    }

	editExperienceData = function (itemId) {
        //this is called when the user submits the add/edit experience form
        $.ajax({
        	type: 'POST',
            url: "{% url 'edit_experience' %}",
            data: $("#experience-form").serialize(),
            beforeSend : function() {

            },
            success: function (data) {
                if(itemId == 0)
                    $("#experience-list").append(data)
                else if(itemId > 0)
                    editExperienceItem.html(data);
                $("#edit-experience-modal").modal('toggle');
            },
            error: function(data) {

            },
            complete : function() {

            }
        });
    };

    //project
    editProjectForm = function(itemId) {
        //get the form for add/edit project for the user to either add or edit
        $.ajax({
            type: 'POST',
            url: "{% url 'get_project_form' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                id: itemId,
            },
            beforeSend : function() {

            },
            success: function (data) {
                $("#edit-project-modal").modal('show');                
                $("#project-form-body").html(data);
                $("#project_item_id").val(itemId);
                $("#edit-project-data").attr("data-type", itemId);
            },
            error: function(data) {
                
            },
            complete : function() {
                
            }
        });
    }

    editProjectData = function (itemId) {
        //this is called when the user submits the add/edit project form
        $.ajax({
            type: 'POST',
            url: "{% url 'edit_project' %}",
            data: $("#project-form").serialize(),
            beforeSend : function() {

            },
            success: function (data) {
                if(itemId == 0)
                    $("#project-list").append(data)
                else if(itemId > 0)
                    editProjectItem.html(data);
                $("#edit-project-modal").modal('toggle');
            },
            error: function(data) {

            },
            complete : function() {

            }
        });
    };

    //education
    editEducationForm = function(itemId) {
        //get the form for add/edit education for the user to either add or edit
        $.ajax({
            type: 'POST',
            url: "{% url 'get_education_form' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                id: itemId,
            },
            beforeSend : function() {

            },
            success: function (data) {
                $("#edit-education-modal").modal('show');                
                $("#education-form-body").html(data);
                $("#education_item_id").val(itemId);
                $("#edit-education-data").attr("data-type", itemId);
            },
            error: function(data) {
                
            },
            complete : function() {
                
            }
        });
    }

    editEducationData = function (itemId) {
        //this is called when the user submits the add/edit education form
        $.ajax({
            type: 'POST',
            url: "{% url 'edit_education' %}",
            data: $("#education-form").serialize(),
            beforeSend : function() {

            },
            success: function (data) {
                if(itemId == 0)
                    $("#education-list").append(data)
                else if(itemId > 0)
                    editEducationItem.html(data);
                $("#edit-education-modal").modal('toggle');
            },
            error: function(data) {

            },
            complete : function() {

            }
        });
    };

    //publication
    editPublicationForm = function(itemId) {
        //get the form for add/edit publication for the user to either add or edit
        $.ajax({
            type: 'POST',
            url: "{% url 'get_publication_form' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                id: itemId,
            },
            beforeSend : function() {

            },
            success: function (data) {
                $("#edit-publication-modal").modal('show');                
                $("#publication-form-body").html(data);
                $("#publication_item_id").val(itemId);
                $("#edit-publication-data").attr("data-type", itemId);
            },
            error: function(data) {
                
            },
            complete : function() {
                
            }
        });
    }

    editPublicationData = function (itemId) {
        //this is called when the user submits the add/edit project form
        $.ajax({
            type: 'POST',
            url: "{% url 'edit_publication' %}",
            data: $("#publication-form").serialize(),
            beforeSend : function() {

            },
            success: function (data) {
                if(itemId == 0)
                    $("#publication-list").append(data)
                else if(itemId > 0)
                    editPublicationItem.html(data);
                $("#edit-publication-modal").modal('toggle');
            },
            error: function(data) {

            },
            complete : function() {

            }
        });
    };

    //contact
    editContactData = function () {
        $.ajax({
        	type: 'POST',
            url: "{% url 'edit_contact' %}",
            data: $("#contact-form").serialize(),
            beforeSend : function() {

            },
            success: function (data) {
            	$("#personal-email").text(data.personal_email);
            	$("#phone-number").text(data.phone_number);
                $("#edit-contact-modal").modal('toggle');
            },
            error: function(data) {
                
            },
            complete : function() {

            }
        });
        return false;
    };

});
</script>
{% endblock %}